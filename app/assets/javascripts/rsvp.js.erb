$(document).ready(function() {

  $('#search').on("input", function(e){
    e.preventDefault();
    e.stopPropagation();
    var url = '/rsvps';
    var q = $('#search').serialize()
    $.get(url, q, function(html) {
      $('#rsvp-results').html(html)
    })
  });

  $('html').on('click', '.checkin', function(e){
    e.preventDefault();
    e.stopPropagation();
    var id = $(this).data('id');
    $('#load-ani-'+id).show();
    var url = '/rsvps/check_in';
    $.ajax({
      type: "POST",
      url: url,
      dataType: 'script',
      data: {
          'id': $(this).data('id'),
          'attended': true
        }
    });
  });

  $('html').on('click', '.checkout', function(e){
    e.preventDefault();
    e.stopPropagation();
    var id = $(this).data('id');
    $('#load-ani-'+id).show();
    var url = '/rsvps/check_out';
    $.ajax({
      type: "POST",
      url: url,
      dataType: 'script',
      data: {
          'id': $(this).data('id'),
          'attended': false
        }
    });
  });

  $('header').on('click', '.refresh', function(e){
    e.preventDefault();
    e.stopPropagation();
    var url = '/sync';
    $.ajax({
      type: "GET",
      url: url
    });
  });

  $('.container').on('click', '.rsvp-name', function(e){
    e.preventDefault();
    e.stopPropagation();
    var url = this.attributes.href.value
    var desktop = true;
    $.get(url, function(html) {
      $('.show-card-content').html(html)
      showCard();
      $('.rsvp-name').removeClass("black");
      $('a[href="' + url + '"]').addClass("black");
    });
  });

  $('.container').on('click', '.guests a', function(e){
    e.preventDefault();
    e.stopPropagation();
    if (this.classList.contains("new-ticket")) {
      var url = this.attributes.href.value
      $.get(url, function(html) {
        $('.show-card-content').html(html)
        showCard();
      });
    } else {
      var url = this.attributes.href.value
      $.get(url, function(html) {
        $('.show-card-content').html(html)
        showCard();
      });
    }
  });

  $('.add-rsvp a').on('click', function(e){
    e.preventDefault();
    e.stopPropagation();
    var url = this.attributes.href.value
    var page = "newRsvp"
    $.get(url, function(html) {
      $('.show-card-content').html(html)
      updateIcons(page);
      showCard();
    });
  });

  $('.settings a').on('click', function(e){
    e.preventDefault();
    e.stopPropagation();
    var url = this.attributes.href.value
    var page = "settings"
    $.get(url, function(html) {
      $('.show-card-content').html(html)
      updateIcons(page);
      // $('.settings a').css("color", "#0AC4F8")
      // $('.settings a img').attr("src", "<%= asset_path("Icon/Gear/Color.svg") %>")
      showCard();
    });
  });

  $('.container').on('click', '.show-card-close', function(e){
    $('.show-card').hide();
    $('.rsvp-name').removeClass("black");
    $('body').removeClass("overflow-hidden");
  });

  $('body').on('click', '.check-in', function(e){
    e.preventDefault();
    e.stopPropagation();
    var page = "checkIn"
    updateIcons(page);
    $('.show-card').hide();
    $('.rsvp-name').removeClass("black");
    $('body').removeClass("overflow-hidden");
  });

})

function updateIcons(page) {

  $.each($('.icons a p'), function(key, value){
    $(value).css("color", "#7c7c7c")
  });

  $.each($('.icons a img'), function(key, value){
    if ($(value).attr("src").includes("Checkmark")) {
      var newSrc = "<%= asset_path("Icon/Checkmark/Grey.svg") %>"
    } else if ($(value).attr("src").includes("Add")) {
      var newSrc = "<%= asset_path("Icon/Add/Grey.svg") %>"
    } else if ($(value).attr("src").includes("Gear")) {
      var newSrc = "<%= asset_path("Icon/Gear/Grey.svg") %>"
    }
    $(value).attr("src", newSrc)
  });

  if (page === "settings") {
    $('.settings a p').css("color", "#0AC4F8")
    $('.settings a img').attr("src", "<%= asset_path("Icon/Gear/Color.svg") %>")
  } else if (page === "newRsvp") {
    $('.add-rsvp a p').css("color", "#0AC4F8")
    $('.add-rsvp a img').attr("src", "<%= asset_path("Icon/Add/Color.svg") %>")
  } else if (page === "checkIn") {
    $('.check-in a p').css("color", "#0AC4F8")
    $('.check-in a img').attr("src", "<%= asset_path("Icon/Checkmark/Color.svg") %>")
  } else {};
};

function showCard() {
  $('.show-card').show();
  $('body').addClass("overflow-hidden");
  if ($(window).width() > 792) {
    $("html, body").animate({ scrollTop: 0 }, "slow");
  } else {
    window.scrollTo(0, 0);
  }
};
